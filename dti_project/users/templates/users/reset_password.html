{% extends 'users/layout.html' %}

{% block title %} Reset Password {% endblock %}

{% block body %}
<div class="glass-layer">
    <div class="authentication-form-container">

        <header>
            <h2>Reset Your Password</h2>
            <h3>Enter your new password below.</h3>
        </header>

        <form method="post" id="reset-password-form">
            {% csrf_token %}

            <div class="form-group">
                <label for="id_password">New Password</label>
                <input type="password" name="password" id="id_password" placeholder="New password" required>
            </div>

            <div class="form-group">
                <label for="id_password2">Confirm Password</label>
                <input type="password" name="confirm_password" id="id_password2" placeholder="Confirm password" required>
            </div>

            <button type="submit">Reset Password</button>

            {% if error %}
                <p class="error-message" style="color:red">{{ error }}</p>
            {% endif %}
        </form>

        <div class="message-feedback-container">
            <p>Remembered your password? <a href="{% url 'sign-in' %}">Sign in</a></p>
        </div>

    </div>
</div>

<script>
document.getElementById('reset-password-form').addEventListener('submit', function(e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);

    fetch(form.action || window.location.href, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.success && data.redirect) {
            window.location.href = data.redirect;
        } else if (data.message) {
            const errorEl = document.querySelector('.error-message');
            if (errorEl) {
                errorEl.textContent = data.message;
            } else {
                const p = document.createElement('p');
                p.className = 'error-message';
                p.style.color = 'red';
                p.textContent = data.message;
                form.appendChild(p);
            }
        }
    })
    .catch(err => console.error(err));
});
</script>
{% endblock %}
