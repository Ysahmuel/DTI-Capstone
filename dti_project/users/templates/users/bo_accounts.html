{% extends 'dashboard/layout.html' %}

{% block title %}Business Owners{% endblock %}

{% block body %}

{% include 'users/components/users_list_header.html' with title='Manage Business Owners' %}
{% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div 
        class="alert 
        {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %}" 
        role="alert"
      >
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}


<div style="padding: 20px; overflow-x: auto;">
    <table class="documents-table" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="padding: 12px 15px; text-align: left;">Name</th>
                <th style="padding: 12px 15px; text-align: left;">Email</th>
                <th style="padding: 12px 15px; text-align: center;">Status</th>
                <th style="padding: 12px 15px; text-align: center;">Date Joined</th>
                <th style="padding: 12px 15px; text-align: center;">Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for user in businesshumans %}
            <tr style="border-bottom: 1px solid #ddd;">
                <td style="padding: 12px 15px;">{{ user.get_full_name }}</td>
                <td style="padding: 12px 15px;">{{ user.email }}</td>
                <td style="padding: 12px 15px; text-align: center;">
                    {% if user.role == 'unverified_owner' %}
                    <span class="status-badge status-badge-warning">Unverified</span>
                    {% elif user.role == 'business_owner' %}
                    <span class="status-badge status-badge-approved">Verified</span>
                    {% else %}
                    <span class="status-badge status-badge-light">—</span>
                    {% endif %}
                </td>
                <td style="padding: 12px 15px; text-align: center;">
                    {{ user.date_joined|date:"M d, Y" }}
                </td>
                <td style="padding: 12px 15px; text-align: center;">
                    {% if user.role == 'unverified_owner' %}
                    <!-- Trigger modal -->
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                        data-bs-target="#verifyModal{{ user.id }}">
                        Verify
                    </button>
                    {% else %}
                    <span class="text-muted">—</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="padding: 12px 15px; text-align: center; color: #777;">
                    No business owners found.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Verification Modals -->
{% for user in businesshumans %}
{% if user.role == 'unverified_owner' %}
<div class="modal fade centered-modal" id="verifyModal{{ user.id }}" tabindex="-1"
    aria-labelledby="verifyModalLabel{{ user.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="verifyModalLabel{{ user.id }}">
                    Verification Documents for {{ user.get_full_name }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if user.verification_documents.exists %}
                <div class="row">
                    {% for doc in user.verification_documents.all %}
                    <div class="col-md-4 mb-3 text-center">
                        <a href="{{ doc.file.url }}" target="_blank">
                            <img src="{{ doc.file.url }}" alt="{{ doc.file.name }}"
                                class="img-fluid rounded verification-thumb"
                                style="max-height: 150px; cursor: pointer;">
                        </a>
                        <p class="mt-1">
                            <small>Uploaded at: {{ doc.uploaded_at|date:"M d, Y H:i" }}</small>
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No documents uploaded yet.</p>
                {% endif %}
            </div>
            <div class="modal-footer">
                <form method="POST" action="{% url 'view_verification' user.id %}">
                    {% csrf_token %}
                    <button type="submit" name="action" value="deny" class="btn btn-danger">Deny</button>
                    <button type="submit" name="action" value="verify" class="btn btn-success">Verify</button>
                </form>

            </div>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}

<!-- Image Preview Modal -->
<div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-transparent border-0">

{% endblock %}